<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ColabEsports Blog Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- All your existing meta tags, resource hints, etc. are good and remain here -->
  <link rel="preconnect" href="https://theme1-ecru.vercel.app">
  <link rel="dns-prefetch" href="https://theme1-ecru.vercel.app">
  <meta name="description" content="Get expert esports insights, gaming strategies, and CS2, updates on ColabEsports – India’s top competitive gaming blog.">
  <meta property="og:title" content="ColabEsports Blog - Detailed Gaming Insights & Esports Analysis">
  <link rel="canonical" href="https://theme1-ecru.vercel.app/blog-details.html">
  <!-- ... and so on ... -->

  <link rel="preload" href="https://theme1-ecru.vercel.app/assets/css/style.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://theme1-ecru.vercel.app/assets/css/style.min.css"></noscript>
  
  <style>
    body{background:#000;color:#fff;font-family:Poppins,sans-serif}.blog-details-container{max-width:800px;margin:40px auto;background:#141414;border-radius:16px;box-shadow:0 8px 32px #0005;padding:32px 24px}.blog-details-image{width:100%;max-height:400px;object-fit:cover;border-radius:12px;margin-bottom:24px}.blog-details-title{font-size:3.2rem;color:#fff;margin-bottom:12px}.seo-heading{display:none}.blog-details-meta{color:#aaa;margin-bottom:18px}
    
    /* --- STYLES FOR RICH CONTENT FROM THE EDITOR --- */
    .blog-details-content{
      font-size:1.1rem;
      line-height:1.7;
      color:#fff;
    }
    .blog-details-content h1, 
    .blog-details-content h2, 
    .blog-details-content h3 { 
        color: #ffa700; 
        margin-top: 1.5em; 
        margin-bottom: 0.5em; 
        line-height: 1.3;
    }
    .blog-details-content h1 { font-size: 1.8em; }
    .blog-details-content h2 { font-size: 1.5em; }
    .blog-details-content h3 { font-size: 1.2em; }
    .blog-details-content p { margin-bottom: 1em; }
    .blog-details-content a { color: #ffc107; text-decoration: underline; }
    .blog-details-content ul { list-style-type: disc; padding-left: 25px; margin-bottom: 1em; }
    .blog-details-content strong, .blog-details-content b { font-weight: bold; }
    .blog-details-content em, .blog-details-content i { font-style: italic; }
    /* --- END OF NEW STYLES --- */

    .blog-details-share{margin-top:32px}.blog-details-share a{color:#ffa700;margin-right:12px;font-size:1.3em}.blog-related-content{margin-top:40px;padding-top:32px;border-top:1px solid rgba(255,255,255,.1)}.blog-related-content h3{color:#ffa700;font-size:1.8rem;margin-bottom:24px}.related-links{display:grid;grid-template-columns:1fr 1fr;gap:32px}@media (max-width:768px){.related-links{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="blog-details-container" id="blogDetailsContainer">
    <h1 class="seo-heading">ColabEsports Blog Details</h1>
    <p>Loading blog content...</p>
  </div>

  <script type="module">
    // Import Firestore functions from your setup file
    import { db, doc, getDoc } from './assets/firebase/firebase.js';

    // Get the container where the blog will be rendered
    const container = document.getElementById('blogDetailsContainer');
    const params = new URLSearchParams(window.location.search);
    const blogId = params.get('id');

    // Helper to safely escape text for non-HTML fields like title and author
    function escapeHTML(str) {
      const p = document.createElement("p");
      p.textContent = str || '';
      return p.innerHTML;
    }

    // Main function to fetch and display the blog post
    async function showBlogDetails() {
      if (!blogId) {
        container.innerHTML = "<p style='color:red;'>Error: No blog ID provided in the URL.</p>";
        return;
      }

      try {
        const blogRef = doc(db, "blogs", blogId);
        const blogSnap = await getDoc(blogRef);

        if (!blogSnap.exists()) {
          container.innerHTML = "<p style='color:red;'>Error: Blog post not found.</p>";
          return;
        }

        const blog = blogSnap.data();

        // --- THE CRITICAL FIX IS HERE ---
        let contentHtml;
        
        // 1. Check for the new 'detailContent' field from the rich text editor.
        if (blog.detailContent) {
          // If it exists, use it directly. We TRUST this content because only the admin can create it.
          // DO NOT escape this HTML, so the browser can render it.
          contentHtml = blog.detailContent;
        } else {
          // 2. If it doesn't exist (for older posts), fall back to the old plain text field.
          // Escape this old content for security, and convert line breaks to <br> tags.
          const fallbackContent = blog.detailLink || blog.description || "No content available.";
          contentHtml = escapeHTML(fallbackContent).replace(/\n/g, "<br />");
        }
        // --- END OF FIX ---
        
        // Dynamically update the page title and other meta tags for SEO
        document.title = `${blog.title} - ColabEsports Blog`;
        document.querySelector('meta[name="description"]').content = blog.description;
        document.querySelector('meta[property="og:title"]').content = blog.title;
        // You can add more meta tag updates here in the same way

        // Render the full blog post to the page
        container.innerHTML = `
          <img src="${escapeHTML(blog.imageUrl)}" alt="${escapeHTML(blog.title)}" class="blog-details-image">
          <div class="blog-details-meta">
            <span>By ${escapeHTML(blog.author)}</span> &nbsp;|&nbsp;
            <span>${blog.createdAt?.seconds ? new Date(blog.createdAt.seconds * 1000).toLocaleDateString() : 'Unknown Date'}</span>
          </div>
          <h2 class="blog-details-title">${escapeHTML(blog.title)}</h2>
          
          <!-- This div will now correctly render the H1, bold, italic, etc. from your editor -->
          <div class="blog-details-content">
            ${contentHtml}
          </div>
          
      
          <div class="blog-details-share">
            <span>Share:</span>
            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank" rel="noopener"><i class="fab fa-facebook-f"></i></a>
            <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}" target="_blank" rel="noopener"><i class="fab fa-x-twitter"></i></a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(window.location.href)}" target="_blank" rel="noopener"><i class="fab fa-linkedin-in"></i></a>
          </div>
        `;
      } catch (err) {
        container.innerHTML = "<p style='color:red;'>An error occurred while loading the blog.</p>";
        console.error("Error loading blog details:", err);
      }
    }

    // Run the function to load the blog post as soon as the page is ready
    showBlogDetails();
  </script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" async defer></script>
</body>
</html>
